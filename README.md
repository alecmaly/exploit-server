# Configure host

```bash
##### install dependencies #####
sudo apt update && sudo  apt upgrade -y
sudo apt-get install -y certbot python3-pip

##### open ports 80 and 443 #####
uwf enable
uwf allow 80/tcp
uwf allow 443/tcp
ufw reload && service iptables restart
# may require reboot?
# view iptables:   iptables -nvL 

##### get ssl certificates #####
certbot certonly -d do6.us -n --standalone --agree-tos -m alecmaly@ymail.com
```

## Configure SSL cron

[ssl gunicorn config](https://medium.com/trabe/deploying-a-flask-application-with-gunicorn-and-docker-2bc7c4c10dd4)

**create cronjob**
```bash
# as root user
30 2 * * 1 /opt/exploit_server/renew_and_start.sh
```


## Copy files to server
```bash
# copy files to /tmp
scp -r -i ssh2.key /mnt/c/Users/alecj/OneDrive/Desktop/shared_vm/exploit_server/ ubuntu@129.158.230.158:/tmp

# ssh to server and move files to /opt
ssh -i ssh2.key ubuntu@129.158.230.158
sudo mv /tmp/exploit_server /opt
```



# Flask Exploit Server
Runs an exploit server for customized payload delivery


## Setup
Install the required packages:
```py
pip install -r requirements.txt

# set login password (CHANGE THIS)
export PASSWORD="password"
```

## Run
### Flask (dev)
```bash
python run.py run -h 0.0.0.0 -p 5000
```

### Gunicorn (prod)
Note, should run as non-root user. To do this, must configure so application can run on priviledged ports (80 | 443) and move certs to a readable location.

```bash
gunicorn -w 2 -b :80 run:app &
gunicorn -w 2 -b :443 --certfile /etc/letsencrypt/live/do6.us/fullchain.pem --keyfile  /etc/letsencrypt/live/do6.us/privkey.pem run:app &

# kill all gunicorn instances
pkill gunicorn
```

After the initialization the port will be displayed. Head to localhost:port.

