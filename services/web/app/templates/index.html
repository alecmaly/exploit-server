<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <title>Exploit Server</title>
		
		<!-- css from w3 site for the table -->
        <style>
            table {
                font-family: arial, sans-serif;
                border-collapse: collapse;
                width: 100%;
            }
            td, th {
                border: 1px solid #dddddd;
                text-align: left;
                padding: 8px;
            }
            tr:nth-child(even) {
                background-color: #dddddd;
            }
        </style>
    </head>

    <body onload="updateFullUrl()">
        <h1>Craft a response</h1>

        <form id="feedbackForm" action="/" method="POST" style="max-width: unset">
            URL: <span id="exploit-path"></span><br><br>

            HTTPS: <input type="checkbox" style="width: auto" name="exploit-https" checked="" onchange="updateFullUrl()"><br><br>

            File: 
            <input type="text" name="exploit-file" value="{{exploit_path}}" oninput="updateFullUrl()"><br><br>
            
            Headers:<br>
            <a target="_blank" href='https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types'>Common mime types</a> |         
            <button onclick="event.preventDefault(); let d = document.querySelector('#common-mime-types'); d.style.display == 'none' ? d.style.display = 'block' : d.style.display = 'none'">Show/Hide common mime types</button>
            <span id='common-mime-types' style='display: none'>
                application/octet-stream<br>
                text/plain<br>
                text/html<br>
                application/json<br>
                application/xml<br>
                application/zip<br>
                image/png<br>
            </span>
            <br><br>
            <textarea rows="12" cols="300" name="exploit-header">{{exploit_header}}</textarea><br><br>

            Body:<br>
            Base64 Encoded payload/body: <input type="checkbox" style="width: auto" name="exploit-body-base64encoded" {{exploit_body_base64Encoded}}><br><br>

            <textarea rows="12" cols="300" name="exploit-body">{{exploit_body}}</textarea><br><br>

            <button class="button" name="formAction" value="STORE" type="submit">
                STORE
            </button>
            <button class="button" name="formAction" value="View Exploit" type="submit">
                View Exploit
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="button" name="formAction" value="DELETE ALL RECORDS" type="submit">
                DELETE ALL RECORDS
            </button>
        </form>
        <br>
        
        <!-- Access Log Buttons -->
        <a href='/api/actions/log'>
            <button class="button" name="formAction" value="View Log">
                Access Log
            </button>
        </a>
        <button class="button" name="formAction" value="View Log" onclick="fetch('/api/actions/log', { method: 'POST', credentials: 'include' }); alert('Log Cleared')">
            Clear Access Log
        </button>
    </body>

    <script>
        function updateFullUrl() {
            let https = document.querySelector("[name='exploit-https']").checked ? 'https' : 'http'
            document.querySelector('#exploit-path').innerText = `${https}://${location.host}${document.querySelector("[name='exploit-file']").value}`
        }

        function viewExploit() {
            document.querySelector('#exploit-path').innerText   
        }
        
    </script>


</html>
